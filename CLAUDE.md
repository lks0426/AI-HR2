# AI-HR项目指导原则

## 🎯 项目概述
**AI+HR市场调研报告网站** - 基于Next.js 15.4.2 + TypeScript + Tailwind CSS的专业商务报告平台

**部署状态**: 已成功部署至 https://ai-hr.lks0426.com
**技术栈**: Next.js 15.4.2, TypeScript, Tailwind CSS v3.4.17, AWS ECS + Fargate

---

## 🎓 核心调试原则

### 基本哲学
**"理解本质，而非反应式修改"**

### 1. 工作配置神圣性原则
- ✅ **如果它工作，就不要动它**
- ✅ 在理解为什么它工作之前，绝不改变working配置
- ❌ 永远不要因为"我觉得这样更好"而改变working配置
- ❌ 避免反应式修改模式：遇到问题就简化配置

### 2. 系统性问题分析流程
```
问题出现 → 理解现有架构 → 隔离问题范围 → 找到根本原因 → 最小化修改 → 验证修改效果
```

### 3. 证据驱动决策
- 区分症状和根本原因
- 用数据和日志验证假设
- 避免基于猜测的修改
- 一次只改变一个变量

---

## 🚨 AWS ECS部署关键经验

### 间歇性问题诊断法则
**如果问题时好时坏 → 很可能是负载均衡器多版本轮询问题**

### 五步诊断法
1. **确认症状**（什么情况下出现问题）
2. **检查基础设施**（负载均衡器、目标组、服务列表）
3. **追踪请求路径**（从DNS到容器的完整链路）
4. **定位根本原因**（通常是配置冲突而非代码问题）
5. **最小化修复**（只改必须改的部分）

### 关键诊断命令
```bash
# 1. 检查目标组健康状态
aws elbv2 describe-target-health --target-group-arn [ARN]

# 2. 列出所有ECS服务
aws ecs list-services --cluster [cluster-name]

# 3. 连续测试诊断间歇性问题
for i in {1..20}; do curl -I [URL] | grep HTTP; sleep 1; done
```

### AWS ECS最佳实践
- **一个功能一个服务**：避免同一功能的多版本并存
- **蓝绿部署**：新版本验证后再停止旧版本
- **资源清理**：部署后及时清理旧资源
- **监控目标组**：定期检查负载均衡器目标健康状态

---

## 🛠️ 项目技术配置

### Docker配置要点
```dockerfile
# 关键：Next.js standalone模式需要三个复制步骤
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
COPY --from=builder --chown=nextjs:nodejs /app/public ./public
```

### .dockerignore必需配置
```
node_modules
.next
.git
```

### Next.js配置（已验证工作）
```javascript
const nextConfig = {
  output: 'standalone',  // 🔒 不要修改此配置
}
```

---

## 🚫 严禁行为模式

### 反应式修改模式（避免）
- ❌ 遇到问题就修改Dockerfile
- ❌ 修改已验证的Next.js配置
- ❌ 同时修改多个配置文件
- ❌ 重复创建而不清理旧资源
- ❌ 暴力删除重建而不追根溯源

### 短视解决方案（避免）
- ❌ 只关注当前错误信息
- ❌ 忽视修改对其他组件的影响
- ❌ 为了"快速解决"而破坏架构一致性

---

## ✅ 推荐解决流程

### 遇到问题时的标准流程
1. **停下来思考**：这个问题的本质是什么？
2. **理解现状**：当前的工作原理是什么？
3. **对比分析**：什么发生了变化？
4. **假设验证**：用证据验证每个假设
5. **最小干预**：做最小的必要修改
6. **全面测试**：确保没有破坏其他功能

### 每次修改前问自己
- 我真的理解问题的根本原因吗？
- 这个修改会影响其他什么组件？
- 有没有更小的修改方法？
- 我能用数据证明这个修改是正确的吗？
- 如果这个修改有问题，我能快速回滚吗？

---

## 🔑 关键启示

1. **间歇性问题通常指向负载均衡**：多个版本在轮询
2. **先看基础设施，后看代码**：大多数部署问题源于资源配置
3. **清理比修复更重要**：AWS资源容易累积，定期清理避免冲突
4. **系统思维优于局部优化**：要看整个请求链路

---

## 📊 项目当前状态

### 生产环境
- **URL**: https://ai-hr.lks0426.com
- **状态**: ✅ 正常运行
- **架构**: 清洁架构（一个负载均衡器 → 一个目标组 → 一个活跃服务）

### 技术配置
- **ECS集群**: ai-hr-cluster
- **服务**: ai-hr-service-v2
- **任务定义**: ai-hr-task:11
- **目标组**: ai-hr-target-group
- **GitHub仓库**: https://github.com/lks0426/AI-HR2
- **CI/CD状态**: ✅ 已更新匹配新架构

---

**记住：我们的目标是构建稳定、可理解、可维护的系统，而不是快速修复当前的症状。**

*最后更新：2025-07-22*